rules:
  - name: SSH Brute-Force
    conditions:
      - when:
          field: action
          contains: "authentication failure"
        and:
          field: Rhost
          equals: "{{Rhost}}"
        and:
          field: Timestamp
          equals: "{{Timestamp}}"
      - when:
          field: action
          contains: "Failed password"
        and:
          field: IPV4
          equals: "{{IPV4}}"
        and:
          field: Timestamp
          equals: "{{Timestamp}}" 
      - when:
          field: action
          contains: "Accepted password"
        and:
          field: IPV4
          equals: "{{IPV4}}"
        and:
          field: Timestamp
          equals: "{{Timestamp}}"
      - when:
          field: Message
          contains: "session opened"
        and:
          field: IPV4
          equals: "{{IPV4}}"
        and:
          field: Timestamp
          equals: "{{Timestamp}}"

    actions:
      - set:
          field: IP
          value: "{{IPV4}}"
      - set:
          field: User
          value: "{{User}}"
      - log: "Possible SSH Brute-Force attack detected from {{IP}} with username {{User}} at {{Timestamp}}."
        file: "/home/codespace/test/ssh_bruteforce.log"